---
title: Caching (Redis)
category: TIL
order: 8
---

### Caching이란 ?

<div class="content-box">
<li>Caching은 데이터나 계산 결과를 임시로 저장하여 이후 요청에서 빠르게 제공하는 기술</li>
</div>

###  Redis란?

<div class="content-box">
<li>Redis(Remote Dictionary Server)는 오픈 소스의 메모리 기반 데이터 저장소.</li>
<li>데이터를 메모리에 저장하므로 빠른 데이터 액세스를 제공하며, 주로 Key-Value 스토어로 사용</li>
<li>Redis는 데이터를 디스크에도 저장할 수 있으므로 데이터의 영속성을 보장.</li>
</div>

##### Redis를 Caching에 사용하는 이유

* **1. 빠른 속도**: <br>
Redis는 메모리에 데이터를 저장하고 빠르게 검색할 수 있으므로 데이터 액세스가 빠름<br>
* **2. 유연성**: <br>Redis는 다양한 데이터 구조를 지원하며, Key-Value, 리스트, 해시, 집합, 정렬 집합 등 다양한 데이터 형식을 처리할 수 있음<br>
* **3.데이터 영속성**:<br>
Redis는 데이터를 디스크에 저장할 수 있어 데이터 손실을 방지할 수 있음
* 
##### Redis Caching의 작동 방식
* **1. 데이터 캐싱**: <br>Redis는 데이터베이스 또는 다른 소스로부터 데이터를 가져와 메모리에 캐싱
* **2. 캐싱된 데이터 사용**: <br>다음 요청이 들어올 때 Redis에서 데이터를 가져와 사용자에게 제공
* **3. 만료 시간 설정**: <br>캐시된 데이터에 만료 시간을 설정하여 일정 기간 후에 데이터가 자동으로 만료
* **4.캐시 삭제**: <br>데이터가 업데이트되거나 더 이상 필요하지 않을 때 Redis에서 캐시를 삭제

##### Redis Caching의 장점
* **1. 빠른 응답 시간**: <br>메모리에 데이터를 저장하므로 데이터 액세스가 빠름
* **2. 부하 감소**: <br>데이터베이스 또는 다른 시스템에 대한 부하를 줄일 수 있음
* **3. 데이터 일관성**: <br>데이터베이스와 동기화하여 데이터 일관성을 유지할 수 있음
* **4. 확장성**: <br>Redis 클러스터를 사용하여 데이터 용량을 확장할 수 있음.

##### Redis Caching 사용 사례

**1.** 웹 애플리케이션에서 페이지 렌더링 속도 향상<br>
**2.** 데이터베이스 쿼리 결과의 캐싱<br>
**3.** 세션 관리<br>
**4.** 실시간 알림 처리<br>
**5.** 빠른 카운팅 및 집계<br>

### 사용예시 (코드)

##### RedisConfig.java
```java
    @Bean
    public RedisCacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) {
        // Redis 캐시 설정 구성
        RedisCacheConfiguration cacheConfiguration = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofDays(1)) // 캐시 항목의 만료 기간을 1일로 설정
                .serializeKeysWith(
                        RedisSerializationContext.SerializationPair
                                .fromSerializer(new StringRedisSerializer())) // 캐시 키를 문자열로 직렬화
                .serializeValuesWith(
                        RedisSerializationContext.SerializationPair
                                .fromSerializer(new GenericJackson2JsonRedisSerializer())); // 캐시 값을 JSON으로 직렬화

        // RedisCacheManager 빌더를 사용하여 Redis 캐시 매니저 생성
        return RedisCacheManager.builder(RedisCacheWriter.lockingRedisCacheWriter(redisConnectionFactory))
                .cacheDefaults(cacheConfiguration) // 기본 캐시 구성 설정
                .build(); // Redis 캐시 매니저 생성
    }
```

##### Cache 조회 후 없으면 저장
```java
    @Cacheable(value = "sggLatLonList", key = "'sggList'")
    public List<SggLatLonDTO> getSggLatLons() {
        return sggLatLonRepository.findAll().stream()
                .map(SggLatLonDTO::from)
                .collect(java.util.stream.Collectors.toList());
    }
```

##### Cache 삭제
```java
    @CacheEvict(value = "sggLatLonList", key = "'sggList'")
    public void updateCsv(MultipartFile csvFile) {
        try (BufferedReader br = new BufferedReader(new InputStreamReader(csvFile.getInputStream()))) {
            // 첫 번째 줄은 제목 행이므로 한 번 읽어서 무시.
            br.readLine();

            String line;
            while ((line = br.readLine()) != null) {
                String[] data = line.split(",");
                sggLatLonRepository.save(SggLatLon.from(data));
            }

        } catch (IOException e) {
            log.error("파일 읽기 실패 {}", e.getMessage());
        }
    }
```
