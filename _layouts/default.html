<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		{% seo %}
		{% feed_meta %}
		<link rel="stylesheet" href="{{ site.baseurl }}/css/main.css">
		<link rel="apple-touch-icon" href="{{ site.baseurl }}/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="{{ site.baseurl }}/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="{{ site.baseurl }}/images/favicon.png">
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

		{% if jekyll.environment == 'production' and site.google_analytics_key != '' %}
			<script>
				window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
				ga('create', '{{ site.google_analytics_key }}', 'auto');
				ga('send', 'pageview');
			</script>
			<script async src='https://www.google-analytics.com/analytics.js'></script>
		{% endif %}
	</head>

	<body>
		<header class="post-title">
			<h1>
				<a href="{{ site.baseurl }}/"><img src="{{ site.baseurl }}/images/favicon.png" alt="{{ site.title }} logo"></a>
				<span>{{ site.title }}</span>
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="{{ site.baseurl }}/search/" method="get">
				<div class="search-wrap">
					<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
					<button type="button" class="btn-del"><span>삭제</span></button>
				</div>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav {% if site.show_full_navigation %}class="full-navigation"{% endif %}>
				<div class="switch__wrap">
					<label class="switch" for="switch-1">
						<input type="checkbox" id="switch-1" data-input="switch__theme">
						<span class="switch__toggle" aria-hidden="true"></span>
					</label>
				</div>

				<ul>
					<li class="nav-item top-level {% if page.url == '/' %}current{% endif %}">
						{% assign home = site.html_pages | where: 'url', '/' | first %}
						<a href="{{ site.baseurl }}/">{{ home.title }}</a>
					</li>
				
					{% assign grouped = site.docs | group_by: 'category' %}
					{% for group in grouped %}
						<li class="nav-item top-level {% if group.name == page.category %}current{% endif %}">
							{% assign items = group.items | sort: 'order' %}
							<a href="{{ site.baseurl }}{{ items.first.url }}">{{ group.name }}</a>
							<ul>
								{% for item in items %}
									<li class="nav-item {% if item.url == page.url %}current{% endif %}"><a href="{{ site.baseurl }}{{ item.url }}">{{ item.title }}</a></li>
								{% endfor %}
							</ul>
						</li>
					{% endfor %}
				
					<li class="nav-item top-level {% if page.url == '/changelog/' %}current{% endif %}">
						{% assign changelog = site.html_pages | where: 'url', '/changelog/' | first %}
						<a href="{{ site.baseurl }}/changelog/">{{ changelog.title }}</a>
					</li>
				</ul>
			</nav>
		</header>
	
		<section class="main post-article">
			<div class="page-header">
				<h2>{% if page.category %}{{ page.category }}{% else %}{{ site.title }}{% endif %}</h2>
				<h3>{{ page.title }}</h3>
			</div>
			
			<article class ="content">
				{{ content }}
			</article>
		</section>
		
		<div class="toc">
			<!-- <h6 class="toc-heading">Table of Contents</h6> -->
			{% include toc.html html=content %}
			<div class="top-button">
				<a href="#" class="btn-top">TOP</a>
			</div>
		</div>			

		<script>
		//톡 활성화
		function activateTOC() {
    var tocLinks = document.querySelectorAll(".toc a"); // TOC 항목 링크 선택

    // 스크롤 이벤트 처리
    window.addEventListener("scroll", function () {
      var scrollPosition = window.pageYOffset || document.documentElement.scrollTop;

      // TOC 항목 순회
      tocLinks.forEach(function (link) {
        var sectionId = link.getAttribute("href").substring(1); // 링크의 대상 섹션 ID 가져오기
        var section = document.getElementById(sectionId); // 대상 섹션 요소 선택

        if (section) {
          var sectionTop = section.offsetTop; // 대상 섹션의 위쪽 위치

          if (scrollPosition >= sectionTop) {
            // 스크롤 위치와 대상 섹션 위치 비교
            tocLinks.forEach(function (link) {
              link.classList.remove("active"); // 모든 TOC 항목 비활성화
            });
            link.classList.add("active"); // 현재 섹션에 해당하는 TOC 항목 활성화
          }
        }
      });
    });
  }

  // 페이지 로드 시 TOC 활성화
  document.addEventListener("DOMContentLoaded", function () {
    activateTOC();
  });

		//스무스 스크롤
		function smoothScroll(target) {
		console.log('Target:', target);
		const element = document.querySelector(target);
		const section = document.querySelector('.main.post-article');

		if (element && section) {
			section.scrollTo({
			top: element.offsetTop,
			behavior: 'smooth'
			});
		}
		}


		//scrollTop
		document.querySelector('.btn-top').addEventListener('click', function() {
			var section = document.querySelector('.main.post-article');
			section.scrollTo({
				top: 0,
				behavior: 'smooth'
			});
		});

		//search value delete
		const inputEl = document.querySelector('#search-input');
		const buttonEl = document.querySelector('.btn-del');
		buttonEl.classList.add('hide');
		inputEl.addEventListener('input', function() {
			if (inputEl.value !== "") {
				buttonEl.classList.remove('hide');
			} else {
				buttonEl.classList.add('hide');
			}
		});
		buttonEl.addEventListener('click', function() {
			inputEl.value = "";
			buttonEl.classList.add('hide');
		});

		//switch theme
		const rootElement = document.documentElement;
		const themeSwitchCheckbox = document.querySelector('[data-input="switch__theme"]');
		const localStorageKey = 'theme';

		function setThemePreference(theme) {
			if (theme === 'dark') {
				rootElement.setAttribute('data-theme', 'dark');
				themeSwitchCheckbox.checked = true;
			} else {
				rootElement.setAttribute('data-theme', 'light');
				themeSwitchCheckbox.checked = false;
			}
		}
		function toggleTheme() {
			if (themeSwitchCheckbox.checked) {
				localStorage.setItem(localStorageKey, 'dark');
				rootElement.setAttribute('data-theme', 'dark');
			} else {
				localStorage.setItem(localStorageKey, 'light');
				rootElement.setAttribute('data-theme', 'light');
			}
		}

		themeSwitchCheckbox.addEventListener('change', toggleTheme);

		const storedTheme = localStorage.getItem(localStorageKey);
		if (storedTheme) {
			setThemePreference(storedTheme);
		} else {
			const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
			setThemePreference(isDarkMode ? 'dark' : 'light');
		}

		window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
			if (!localStorage.getItem(localStorageKey)) {
				setThemePreference(e.matches ? 'dark' : 'light');
			}
		});

		//
		// const switchTheme = document.querySelector('input[data-input="switch__theme"]');
		// const root = document.querySelector(':root');

		// switchTheme.addEventListener('click', function() {
		// 	if (this.checked) {
		// 		root.dataset.theme = 'dark';
		// 		localStorage.setItem('theme', 'dark');
		// 	} else {
		// 		root.dataset.theme = 'light';
		// 		localStorage.setItem('theme', 'light');
		// 	}
		// });

		// if (localStorage.getItem('theme')) {
		// 	root.dataset.theme = localStorage.getItem('theme');
		// 	switchTheme.checked = localStorage.getItem('theme') === 'dark';
		// }
	</script>
	</body>
</html>